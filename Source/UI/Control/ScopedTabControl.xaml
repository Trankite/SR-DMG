<TabControl
    x:Class="StarRailDamage.Source.UI.Control.ScopedTabControl"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:StarRailDamage.Source.UI.Control">
    <TabControl.Template>
        <ControlTemplate TargetType="{x:Type TabControl}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="10"/>
                </Grid.RowDefinitions>

                <UniformGrid Grid.Row="0" Name="HeaderPanel" Rows="1" IsItemsHost="True"/>
                <ContentPresenter Grid.Row="1" Name="ContentPanel" ContentSource="SelectedContent"/>
            </Grid>
        </ControlTemplate>
    </TabControl.Template>
    <TabControl.ItemContainerStyle>
        <Style TargetType="{x:Type TabItem}">
            <Setter Property="Foreground" Value="{Binding Foreground,RelativeSource={RelativeSource AncestorType={x:Type local:ScopedTabControl}}}"/>
            <Setter Property="Background" Value="{Binding Background,RelativeSource={RelativeSource AncestorType={x:Type local:ScopedTabControl}}}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type TabItem}">
                        <Border Name="PART_Border" CornerRadius="10" Margin="{Binding Padding,RelativeSource={RelativeSource AncestorType={x:Type local:ScopedTabControl}}}" Background="{TemplateBinding Background}">
                            <Grid Margin="5,0,5,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <ContentPresenter Grid.Column="1" ContentSource="Header" VerticalAlignment="Center"/>
                                <local:ScopedButton Grid.Column="2" Width="20" Height="20" CornerRadius="5" Foreground="{TemplateBinding Foreground}" HorizontalAlignment="Right" Click="TabItemClose">
                                    <TextBlock Text="×" FontSize="15" VerticalAlignment="Center"/>
                                </local:ScopedButton>
                            </Grid>
                        </Border>

                        <ControlTemplate.Triggers>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="PART_Border" Property="Background" Value="{Binding FocusBrush,RelativeSource={RelativeSource AncestorType={x:Type local:ScopedTabControl}}}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </TabControl.ItemContainerStyle>
</TabControl>